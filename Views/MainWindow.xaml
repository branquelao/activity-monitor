<Window
    x:Class="ActivityMonitor.MainWindow"
    x:Name="RootWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:converters="using:ActivityMonitor.Converters"
    Title="Activity Monitor">

    <Grid x:Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <Grid.Resources>
            <converters:TimeSpanConverter x:Key="TimeSpanConverter"/>
        </Grid.Resources>
        
        <Grid Grid.Row="0"
              Padding="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        Spacing="8">
                <Button x:Name="EndButton"
                        Content="X"
                        Background="Red"
                        Command="{Binding EndTaskCommand}">
                </Button>
                <Button x:Name="CpuButton"
                        Style="{Binding IsCpuMode, Converter={StaticResource HeaderButtonStyleConverter}}"
                        Content="CPU"
                        Command="{Binding CpuCommand}"/>
                <Button x:Name="MemoryButton"
                        Style="{Binding IsMemoryMode, Converter={StaticResource HeaderButtonStyleConverter}}"
                        Content="Memory"
                        Command="{Binding MemoryCommand}"/>
            </StackPanel>
        </Grid>

        <controls:DataGrid x:Name="ProcessGrid"
                           Grid.Row="1"
                           ItemsSource="{Binding Processes}"
                           AutoGenerateColumns="False"
                           IsReadOnly="True"
                           HeadersVisibility="Column"
                           SelectionMode="Single"
                           SelectedItem="{Binding SelectedProcess, Mode=TwoWay}">
            <controls:DataGrid.Columns>
                <controls:DataGridTextColumn
                    x:Name="ProcessColumn"
                    Header="Process"
                    Binding="{Binding Name}"
                    Width="*"/>

                <!-- CPU Mode Columns -->
                <controls:DataGridTextColumn
                    x:Name="CpuColumn"
                    Header="CPU (%)"
                    Binding="{Binding Cpu}"
                    Width="120"
                    Visibility="{x:Bind ViewModel.IsCpuMode, Mode=OneWay}"/>

                <controls:DataGridTextColumn
                    Header="CPU Time"
                    Binding="{Binding CpuTime, Converter={StaticResource TimeSpanConverter}}"
                    Width="140"
                    Visibility="{x:Bind ViewModel.IsCpuMode, Mode=OneWay}" />

                <controls:DataGridTextColumn
                    Header="Threads"
                    Binding="{Binding ThreadCount}"
                    Width="100"
                    Visibility="{x:Bind ViewModel.IsCpuMode, Mode=OneWay}" />

                <controls:DataGridTextColumn
                    Header="PID"
                    Binding="{Binding Id}"
                    Width="90"
                    Visibility="{x:Bind ViewModel.IsCpuMode, Mode=OneWay}" />
                
                <controls:DataGridTextColumn
                    Header="Type"
                    Binding="{Binding OwnerType}"
                    Width="120"
                    Visibility="{x:Bind ViewModel.IsCpuMode, Mode=OneWay}" />

                <!-- Memory Mode Columns -->
                <controls:DataGridTextColumn
                    x:Name="MemoryColumn"
                    Header="Memory (MB)"
                    Binding="{Binding Memory}"
                    Width="150"
                    Visibility="{x:Bind ViewModel.IsMemoryMode, Mode=OneWay}"/>

                <controls:DataGridTextColumn
                    Header="Threads"
                    Binding="{Binding ThreadCount}"
                    Width="100"
                    Visibility="{x:Bind ViewModel.IsMemoryMode, Mode=OneWay}" />

                <controls:DataGridTextColumn
                    Header="Handles"
                    Binding="{Binding HandleCount}"
                    Width="100"
                    Visibility="{x:Bind ViewModel.IsMemoryMode, Mode=OneWay}" />

                <controls:DataGridTextColumn
                    Header="PID"
                    Binding="{Binding Id}"
                    Width="90"
                    Visibility="{x:Bind ViewModel.IsMemoryMode, Mode=OneWay}" />
                
                <controls:DataGridTextColumn
                    Header="Type"
                    Binding="{Binding OwnerType}"
                    Width="120"
                    Visibility="{x:Bind ViewModel.IsMemoryMode, Mode=OneWay}" />
            </controls:DataGrid.Columns>
        </controls:DataGrid>

        <StackPanel Grid.Row="2"
            Orientation="Horizontal"
            HorizontalAlignment="Center"
            Spacing="24"
            Margin="0,8,0,12"
            Visibility="{x:Bind ViewModel.IsCpuMode, Mode=OneWay}">

            <TextBlock FontSize="14">
                <Run Text="CPU Used: "/>
                <Run Text="{x:Bind ViewModel.CpuUsedText, Mode=OneWay}"
                     Foreground="OrangeRed"
                     FontWeight="SemiBold"/>
            </TextBlock>

            <TextBlock FontSize="14">
                <Run Text="CPU Free: "/>
                <Run Text="{x:Bind ViewModel.CpuFreeText, Mode=OneWay}"
                     Foreground="LightGreen"
                     FontWeight="SemiBold"/>
            </TextBlock>
        </StackPanel>

        <StackPanel Grid.Row="2"
            Orientation="Horizontal"
            HorizontalAlignment="Center"
            Spacing="24"
            Margin="0,8,0,12"
            Visibility="{x:Bind ViewModel.IsMemoryMode, Mode=OneWay}">

            <TextBlock FontSize="14">
                <Run Text="Memory Used: "/>
                <Run Text="{x:Bind ViewModel.MemoryUsedText, Mode=OneWay}"
                     Foreground="OrangeRed"
                     FontWeight="SemiBold"/>
            </TextBlock>

            <TextBlock FontSize="14">
                <Run Text="Memory Free: "/>
                <Run Text="{x:Bind ViewModel.MemoryFreeText, Mode=OneWay}"
                     Foreground="LightGreen"
                     FontWeight="SemiBold"/>
            </TextBlock>

        </StackPanel>

    </Grid>
</Window>
